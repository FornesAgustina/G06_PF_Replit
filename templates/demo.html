{% extends 'base.html' %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

{% block titulo %} {% endblock %}
{% block contenido %}{% endblock %}


<body>
  
    <div id="images">
     <h2>hola</h2>
  </div>

  
  <div id="map">
   
  </div>

  
  <div>
  <!--   <button onclick="map.addMarker({lat: -34.614249, lng: -58.422078},true, false, true, true, true);" >AÃ‘ADIR MARCADOR</button> -->

  </div>

 
</body>
<!-- cosas de boostrap 
  
<nav class="navbar navbar-expand-lg bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Navbar</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Link</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Dropdown
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Action</a></li>
            <li><a class="dropdown-item" href="#">Another action</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Something else here</a></li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled">Disabled</a>
        </li>
      </ul>
      <form class="d-flex" role="search">
        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button>
      </form>
    </div>
  </div>
</nav>
<nav class="navbar bg-light">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1">Navbar</span>
  </div>
</nav>

<div class="list-group">
  <a href="#" class="list-group-item list-group-item-action active" aria-current="true">
    <div class="d-flex w-100 justify-content-between">
      <h5 class="mb-1">List group item heading</h5>
      <small>3 days ago</small>
    </div>
    <p class="mb-1">Some placeholder content in a paragraph.</p>
    <small>And some small print.</small>
  </a>
  <a href="#" class="list-group-item list-group-item-action">
    <div class="d-flex w-100 justify-content-between">
      <h5 class="mb-1">List group item heading</h5>
      <small class="text-muted">3 days ago</small>
    </div>
    <p class="mb-1">Some placeholder content in a paragraph.</p>
    <small class="text-muted">And some muted small print.</small>
  </a>
  <a href="#" class="list-group-item list-group-item-action">
    <div class="d-flex w-100 justify-content-between">
      <h5 class="mb-1">List group item heading</h5>
      <small class="text-muted">3 days ago</small>
    </div>
    <p class="mb-1">Some placeholder content in a paragraph.</p>
    <small class="text-muted">And some muted small print.</small>
  </a>
</div>
  
 cosas de boostrap -->


  
<script src="{{url_for('static', filename='mapa/lib/MapaInteractivo.js')}}"></script>
<script>
  let map = new MapaInteractivo("map", {
    preferCanvas: true,
    language: "en",
    attributionControl: true,
    onLayerLoaded: function (layerName, layerId) {console.log (layerName, layerId)},
    onContextMenu: onContextMenu
  });
  map.setHeatMapData([
      [-34.59605809895703,-58.35457413376579, 0.9],
      [-34.59605809895703,-58.35457413376579, 0.9],
      [-34.59605809895703,-58.35457413376579, 0.9],
      [-34.59605809895703,-58.35457413376579, 0.9],
      [-34.59605809895703,-58.35457413376579, 0.9],
      [-34.59605809895703,-58.35457413376579, 0.9],
      [-34.59605809895703,-58.35457413376579, 0.9],
      [-34.59605809895703,-58.35457413376579, 0.9],
    ], {radius: 25}
  );

  function addLayerEstacionamientos() {
    map.addPublicLayer("estacionamiento_en_via_publica", {
      callAPIOnClick: true,
      onClickAPI: "http://epok.buenosaires.gob.ar/atlasvial/buscarInformacionEstacionamiento/?formato=geojson&fullInfo=True&x=$lng&y=$lat&categorias=$categories",
      baseLayer: {
        uri: "http://tiles1.usig.buenosaires.gob.ar/mapcache/tms/1.0.0/estacionamiento_en_via_publica_caba_3857@GoogleMapsCompatible/{z}/{x}/{y}.png"
      }
    });
  }

  function addLayer(id) {
    map.addPublicLayer(id, {clustering: true});
  }
  function onContextMenu(ev) {
    const id = map.addMarker(ev.latlng, true, false, false, false, false, {iconUrl: 'http://static.usig.buenosaires.gob.ar/symbols/bases_extrahospitalarias.png'});
  }

  function getImage() {
    map.getStaticImage().then((canvas) => {
      var img = document.createElement('img');
      var dimensions = map.getMapa().getSize();
      img.width = dimensions.x;
      img.height = dimensions.y;
      img.src = canvas.toDataURL();
      document.getElementById('images').innerHTML = '';
      document.getElementById('images').appendChild(img);
    })
  }

  function addVectorTileLayer(){
    map.addVectorTileLayer('parcelas',{
      url: 'http://example.com/tileserver/parcelas/{z}/{x}/{y}.pbf',
      displayPopup:{ content:'<b>Comuna: </b>{parcela} <br> <b>Barrio: </b>{barrios}', onEvent:'click'},
      style:{
        parcelas:function(properties, zoom, geometryDimension){
          return {
                 weight: (zoom > 12)? 2 : 0.5,
                 fillColor: getColor(properties.comuna),
                 fillOpacity: 0.8,
                 stroke: true,
                 color:'#FF00FF',
                 dashArray: '2',
                 fill: true
            }
        }
      }
    });
  }


  function getColor(d) {
    return d > 12  ? '#E31A1C' :
           d > 9  ? '#FC4E2A' :
           d > 6   ? '#FD8D3C' :
           d > 3   ? '#FEB24C' :
           d > 1   ? '#FED976' :
                      '#FFEDA0';
  }

  //  setTimeout(() => {
//    map.removePublicLayer("estacionamiento_en_via_publica");
//    map.addPublicLayer("cajeros_automaticos", {clustering: true});
//  }, 10000)
</script>
</html>
